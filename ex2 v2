/* Conecte um display 7 segmentos.
Elabore uma aplicação que exibe no display o caractere recebido pela serial.
Devolva pela serial o caractere recebido.*/

#include "stm32g0xx.h"
#include <stdio.h>
#include <stdlib.h>
int deco[] = {0x3F, 0x06, 0x5B, 0x4F, 0x66, 0x6D, 0x7C, 0x07, 0x7F, 0x6F};
int rx = 0, x=0;
void config_serial(void){
	RCC -> APBENR1 |= 0x20000;
	USART2->BRR=1666;
	GPIOA -> MODER |= 0xA0;
	GPIOA->AFR[0] = 0x01100;
	USART2->CR1 = 0x0000002D;
	USART2->CR2 = 0;
	USART2->CR3 = 0;
	NVIC_SetPriority(USART2_LPUART2_IRQn, 1);
	NVIC_EnableIRQ(USART2_LPUART2_IRQn);
}
void USART2_LPUART2_IRQHandler(void) {
if (USART2->ISR & 0x20) {
rx = USART2->RDR - '0';
x++;
}
}
void manda_serial(int a) {
while (!((USART2->ISR) & 0x80)) {};
USART2->TDR = a;
}
int _write(int file, char *ptr, int len) {
  // Implement your write code here, this is used 0by puts and printf for example
  int i = 0;
  for (i = 0; i < len; i++) {
      //lcd_putc((*ptr));
      manda_serial((*ptr));
      ptr++;
  }
  return len;
}
int main(){
	RCC -> IOPENR = 0x3F;
	GPIOC -> MODER = 0x5555; //pc0 ao pc7
	GPIOA -> MODER = 0x28000000;
	config_serial();
	while (1){
if (x>0){
	GPIOC->ODR=deco[rx];
	x=0;
	printf("CARACTERE RECEBIDO: %i\n\r", rx);
}
}
}
